<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE xml>
<odoo noupdate="1">

    <!--Group for clinical manager -->
    <record id="group_clinical_manager" model="res.groups">
        <field name="name">Administrador</field>
    </record>

    <!--Group for clinical doctor -->
    <record id="group_clinical_doctor" model="res.groups">
        <field name="name">Optometra</field>
    </record>

    <!--Group for clinical doctor -->
    <record id="group_clinical_user" model="res.groups">
        <field name="name">user</field>
    </record>


</odoo>
<?xml version="1.0"?>
<form>
                    <header>
<!--                        <field name="state" widget="statusbar" clickable="True"-->
<!--                            options="{'fold_field': 'fold'}"/>-->
                            <field name="stage_id" widget="statusbar" clickable="True" options="{'fold_field': 'fold'}" domain="['|', ('team_id', '=', team_id), ('team_id', '=', False)]" attrs="{'invisible': [('active', '=', False)]}"/>
                            <field name="stage_type" invisible="1"/>
<!--                            <button name="action_create_invoice" string="Create Invoice" groups="website_helpdesk_support_ticket.group_helpdesk_manager" type="object" class="oe_highlight" attrs="{'invisible': [('stage_type', '=','closed')]}"/>-->
<!--                            <button name="action_create_task" string="Create Task" groups="website_helpdesk_support_ticket.group_helpdesk_manager" type="object" class="oe_highlight" attrs="{'invisible': [('stage_type', '=','closed')]}"/>-->
                        <button name="set_to_close" string="Set To Close" attrs="{'invisible':[('is_close','=',True)]}" groups="website_helpdesk_support_ticket.group_helpdesk_manager" type="object" class="oe_highlight"/>
                        <button name="set_to_reopen" string="Re Open" attrs="{'invisible':[('is_close','=',False)]}" groups="website_helpdesk_support_ticket.group_helpdesk_manager" type="object" class="oe_highlight"/>
                    </header>
                    <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="toggle_active" type="object" class="oe_stat_button" icon="fa-archive">
                            <field name="active" widget="boolean_button" options="{&quot;terminology&quot;: &quot;archive&quot;}"/>
                        </button>
                        <button class="oe_stat_button" type="object" name="action_create_invoice" string="Create Invoice" icon="fa-pencil-square-o" groups="website_helpdesk_support_ticket.group_helpdesk_manager"/>
<!--                        <button class="oe_stat_button"-->
<!--                                 type="object" -->
<!--                                 name="action_create_task" -->
<!--                                 string="Create Task" -->
<!--                                 icon="fa-pencil-square-o" -->
<!--                                 groups="website_helpdesk_support_ticket.group_helpdesk_manager"/>-->
                         <button class="oe_stat_button" type="object" name="action_create_task" string="Create Task" icon="fa-pencil-square-o" groups="website_helpdesk_support_ticket.group_helpdesk_manager" attrs="{'invisible': [('stage_type', '=','closed')]}"/>
                        <button class="oe_stat_button" type="object" name="show_task" string="Task" icon="fa-pencil-square" attrs="{'invisible': [('is_task_created', '=',False)]}"/>
                        <button class="oe_stat_button" type="object" name="show_invoice" attrs="{'invisible':[('is_invoice_created','=',False)]}" string="Invoice" icon="fa-fa-briefcase"/>
                        <button class="oe_stat_button" type="object" name="show_analytic_account" string="Analytic Account" icon="fa-book" attrs="{'invisible': [('analytic_account_id', '=',False)]}"/>
                    </div>
                    <div class="oe_title">
                        <div class="oe_title">
                        <h1>
                            <field name="name" readonly="1"/><br/>
                            <field name="subject" readonly="0" attrs="{'readonly': [('stage_type', '=', 'closed')]}" placeholder="Helpdesk Support Subject"/>
                            <field name="is_invoice_created" invisible="1"/>
                            <field name="is_task_created" invisible="1"/>
                        </h1>
                    </div>
                    </div>
                            <group>
                                <group>
                                    <field name="type_ticket_id" attrs="{'readonly': [('stage_type', '=', 'closed')]}"/>
                                    <field name="subject_type_id" attrs="{'readonly': [('stage_type', '=', 'closed')]}"/>
                                    <field name="user_id" attrs="{'readonly': [('stage_type', '=', 'closed')]}"/>
                                    <field name="email" attrs="{'readonly': [('stage_type', '=', 'closed')]}"/>
                                    <field name="company_id"/>
                                </group>
                                <group>
                                    <field name="partner_id" attrs="{'readonly': [('stage_type', '=', 'closed')]}"/>
                                    <field name="phone" attrs="{'readonly': [('stage_type', '=', 'closed')]}"/>
                                    <field name="allow_user_ids" widget="many2many_tags" attrs="{'readonly': [('stage_type', '=', 'closed')]}"/>
                                </group>
                             </group>

                        <group>
<!--                            <group>-->
<!--                                <field name="team_id"/>-->
<!--                                <field name="project_id" filter_domain = "[('partner_id', 'child_of', [partner.commercial_partner_id.id])]"/>-->
<!--                                <field name="department_id" attrs="{'readonly': [('stage_type', '=', 'closed')]}"/>-->
<!--                            </group>-->

                            <group>
<!--                                <field name="team_leader_id"/>-->
<!--                                <field name="analytic_account_id" groups="analytic.group_analytic_accounting"/>-->
<!--                                <field name="priority" />-->

                                <field name="team_id" attrs="{'readonly': [('stage_type', '=', 'closed')]}"/>
                                <field name="project_id" filter_domain="[('partner_id', 'child_of', [partner.commercial_partner_id.id])]" attrs="{'readonly': [('stage_type', '=', 'closed')]}"/>
                                <field name="department_id" attrs="{'readonly': [('stage_type', '=', 'closed')]}"/>
                            </group>

                            <group>
                                <field name="team_leader_id" attrs="{'readonly': [('stage_type', '=', 'closed')]}"/>
                                <field name="analytic_account_id" attrs="{'readonly': [('stage_type', '=', 'closed')]}" groups="analytic.group_analytic_accounting"/>
                                <field name="priority" attrs="{'readonly': [('stage_type', '=', 'closed')]}"/>
                                <field name="category" attrs="{'readonly': [('stage_type', '=', 'closed')]}"/>
                            </group>
                        </group>
                    <group>
                        <group>
                            <field name="request_date" attrs="{'readonly': [('stage_type', '=', 'closed')]}"/>
                            <field name="is_close" attrs="{'readonly': [('stage_type', '=', 'closed')]}"/>
                        </group>
                        <group>
<!--                            <field name="close_date"/>-->
<!--                            <field name="total_spend_hours" widget="float_time"/>-->
                                <field name="close_date" attrs="{'readonly': [('stage_type', '=', 'closed')]}"/>
                                <field name="total_spend_hours" widget="float_time" attrs="{'readonly': [('stage_type', '=', 'closed')]}"/>
                                <p style="color:grey;" colspan="3">To View Current Status of Customer Prepaid Support Hours.Please Click Analytic Account Button.</p>
                                <field name="total_consumed_hours" widget="float_time" attrs="{'readonly': [('stage_type', '=', 'closed')]}"/>
                                <field name="total_purchase_hours" widget="float_time" attrs="{'readonly': [('stage_type', '=', 'closed')]}"/>
                                <field name="remaining_hours" widget="float_time" attrs="{'readonly': [('stage_type', '=', 'closed')]}"/>
                         </group>
                    </group>
                        <notebook>
                        <page name="description" string="Description">
                            <field name="description" placeholder="Add an internal note..." attrs="{'readonly': [('stage_type', '=', 'closed')]}"/>
                        </page>
                        <page name="timesheets" string="Timesheets" groups="base.group_user">
                            <field name="timesheet_line_ids" context="{'default_account_id' :analytic_account_id}" nolabel="1">

                            <field name="timesheet_line_ids" attrs="{'readonly': [('stage_type', '=', 'closed')]}" context="{'default_account_id' :analytic_account_id}" nolabel="1"/>
                                <tree editable="bottom">
                                    <field name="date"/>
                                    <field name="user_id"/>
                                    <field name="account_id" invisible="1"/>
                                    <field name="project_id" required="1"/>
<!--                                    <field name="support_request_id"/-->
                                    <field name="name"/>
                                    <field name="billable"/>
                                    <field name="unit_amount" widget="float_time" string="Hours" sum="Hours"/>
<!--                                    <field invisible="1" name="user_id" required="1"/-->
                                </tree>
                            </field>
                        </page>
                        <page name="invoice_line" string="Add Invoice Lines">
                            <field name="invoice_line_ids" context="{'default_analytic_account_id' :analytic_account_id}" nolabel="1" groups="website_helpdesk_support_ticket.group_helpdesk_manager">

                            <field name="invoice_line_ids" attrs="{'readonly': [('stage_type', '=', 'closed')]}" context="{'default_analytic_account_id' :analytic_account_id}" nolabel="1" groups="website_helpdesk_support_ticket.group_helpdesk_manager"/>
                                <tree editable="bottom">
                                    <field name="product_id"/>
                                    <field name="name"/>
                                    <field name="quantity"/>
                                    <field name="price_unit"/>
                                    <field name="product_uom"/>
                                    <field name="analytic_account_id" options="{'no_open': True, 'no_create': True}" groups="analytic.group_analytic_accounting"/>
                                    <field name="is_invoice"/>
                                </tree>
                            </field>
                        </page>
                        <page name="general_information" string="General Information">
                            <group>
                                <group>
<!--                                    <field name="invoice_id" attrs="{'readonly': [('is_invoice_created', '=',True)]}"/>-->
                                    <field name="invoice_id" attrs="{'readonly': ['|' ,('stage_type', '=', 'closed'),('is_invoice_created', '=',True)]}"/>
<!--                                    <field name="journal_id" attrs="{'readonly': [('is_invoice_created', '=',True)]}"/>-->

                                    <field name="journal_id" attrs="{'readonly': ['|' ,('stage_type', '=', 'closed'), ('is_invoice_created', '=',True)]}"/>
                                    <field name="task_id"/>
                                </group>
                             </group>
                        </page>
                        <page name="customer_rating" string="Customer Rating">
                            <group>
                                <group>
                                    <field name="rating" widget="radio"/>
                                    <field name="comment"/>
                                </group>
                             </group>
                        </page>
                    </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers" groups="base.group_user"/>
                        <field name="message_ids" widget="mail_thread"/>
                         <field name="activity_ids" widget="mail_activity"/>
                    </div>
                </form>
